<script setup lang="ts">
import {computed} from 'vue';
import {useLanguageStore} from '../stores/language';
import {useI18n} from 'vue-i18n';

// Props definition
const props = defineProps<{
  post: {
    id: number;
    title: string;
    cat2: any;       // Category object
    cat3: any;       // Subcategory object
    description: string;
    price: number;
    status: string;
    views: number;
    region: any;
    city: any;
    currency: any;
    images: any[];
  }
}>();

const langStore = useLanguageStore();
const {locale} = useI18n();
locale.value = langStore.lang;

// Get the language
const lang = computed(() => langStore.lang);

// Get the image URL for the first image in the post
const getImage = computed(() => {
  return props.post.images?.[0]?.rs_medium
    ? `https://api.milliy.store/${props.post.images[0].rs_medium}`
    : 'https://via.placeholder.com/300x200';
});

console.log(props.post);
</script>

<template>
  <div class="card product-card">

    <!-- Action buttons (heart and cart) -->

    <button class="btn btn-secondary position-absolute z-1 top-0 end-0 m-1">
      <i class="far fa-heart"></i>
    </button>

    <!-- Image with hover animation -->
    <div class="image-container position-relative">
      <img
        :src="getImage"
        class="card-img-top"
        :alt="post.title"
      />
      <div class="views-badge position-absolute bottom-0 start-0">
        <i class="far fa-eye"></i> {{ $t("views") }}: {{ post.views }}
      </div>
    </div>

    <div class="card-body ">
      <!-- Title -->
      <h5 class="card-title">{{ post.title }}</h5>

      <!-- Category/Subcategory -->
      <div class="card-category">
        {{ post.cat2?.[`name_${lang}`] || '-' }} / {{ post.cat3?.[`name_${lang}`] || '-' }}
      </div>

      <!-- Price -->
      <div class="price">
        {{
          post.price > 0
            ? `${post.price} ${post.currency?.[`name_${lang}`] || ''}`
            : $t("price_negotiable")
        }}
      </div>

      <!-- Location -->
      <div class="location">
        <small class="text-muted">{{ post.region?.[`name_${lang}`] || '-' }}, {{
            post.city?.[`name_${lang}`] || '-'
          }}</small>
      </div>
    </div>
  </div>
</template>


<style scoped>
.product-card {
  position: relative;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.card-img-top {
  width: 100%;
  height: 200px;
  object-fit: cover;
  transition: transform 0.3s ease;
  aspect-ratio: 1;
}

.card-img-top:hover {
  transform: scale(1.05); /* Hover effect */
}

.image-container {
  position: relative;
}

.views-badge {
  background-color: rgba(0, 0, 0, 0.6);
  color: white;
  padding: 5px;
  font-size: 0.75rem;
  border-radius: 5px;
}

.card-body {
  padding: 15px;
}

.card-title {
  font-size: 1.1rem;
  font-weight: 600;
}

.card-category {
  font-size: 0.875rem;
  color: #777;
}

.price {
  font-size: 1.2rem;
  font-weight: 600;
  color: #007bff;
  margin: 10px 0;
}

.location {
  font-size: 0.875rem;
  color: #6c757d;
}


</style>
